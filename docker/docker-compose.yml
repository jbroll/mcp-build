version: '3.8'

services:
  build-env:
    build:
      context: .
      dockerfile: Dockerfile
    image: mcp-build-environment:latest
    container_name: mcp-build-env
    ports:
      # Expose MCP HTTP server port
      - "3344:3344"
    volumes:
      # Mount build directory for persistence
      - build-data:/build
      # Mount MCP server code (for development)
      - ../src:/mcp-server
    environment:
      - BUILD_ENV_BASE=/build
      # MCP Transport Configuration
      - MCP_BUILD_TRANSPORT=stdio
      - MCP_BUILD_HOST=0.0.0.0
      - MCP_BUILD_PORT=3344
      # Set to 'http' and provide a session key to enable HTTP transport
      # - MCP_BUILD_TRANSPORT=http
      # - MCP_BUILD_SESSION_KEY=your-secret-session-key-here
    # Keep container running
    command: tail -f /dev/null
    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '2'
          memory: 4G

volumes:
  build-data:
    driver: local
